<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating data • estimateR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating data">
<meta property="og:description" content="estimateR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">estimateR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/estimateR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adding_methods.html">Adding a new method to the package</a>
    </li>
    <li>
      <a href="../articles/comparison_levels_input_details.html">Estimating Re using more or less detailed data</a>
    </li>
    <li>
      <a href="../articles/incidence_data_workflow_example.html">From aggregated incidence data to Re estimates</a>
    </li>
    <li>
      <a href="../articles/linelist_workflow_example.html">From raw linelist data to Re estimates</a>
    </li>
    <li>
      <a href="../articles/simulating_data.html">Simulating data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simulating_data_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulating data</h1>
            
      
      
      <div class="hidden name"><code>simulating_data.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we demonstrate how to simulate certain types of data to be used in analyses. Simulating data under certain assumptions is an important feature that allows hypothesis testing, proving useful in a number of scenarios. There are three different simulation functions implemented under the estimateR package:</p>
<ul>
<li>
<code><a href="../reference/simulate_infections.html">simulate_infections()</a></code>: used to simulate a series of infections through time, under a certain reproductive number and serial interval</li>
<li>
<code><a href="../reference/simulate_delayed_observations.html">simulate_delayed_observations()</a></code>:used to simulate a series of delayed observations from a given series of infections</li>
<li>
<code><a href="../reference/simulate_combined_observations.html">simulate_combined_observations()</a></code>: used to simulate combined observations. Combined observations are obtained in a real-life scenario when, for some of the cases reported (that have been affected by the full delay since infection; eg. the delay between infection and symptom onset and the delay between symptom onset and case report) the date of symptom onset is also known (only affected by the first delay; eg. the delay between infection and symptom onset). Cases counted as a “partially-delayed observation” (in the <code>partially-delayed</code> column of the result) are not counted again as a “fully-delayed observation” (in the <code>fully-delayed</code> column of the result).</li>
</ul>
<p>We will exemplify use cases for each one of them.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">estimateR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></code></pre></div>
<div id="simulating-a-series-of-infections" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-a-series-of-infections" class="anchor"></a>Simulating a series of infections</h2>
<div id="simulating-epidemics-with-diferent-reproductive-numbers" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-epidemics-with-diferent-reproductive-numbers" class="anchor"></a>Simulating epidemics with diferent reproductive numbers</h3>
<p>Let us assume we need to generate two different infection time-series, one corresponding to an epidemic with a reproductive number of 1.4 and one with a reproductive number of 1.8. We will introduce a constant import of 5 cases per day for the first week to ensure the epidemic does not die off.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">Rt_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1.4</span>, <span class="fl">30</span><span class="op">)</span>
  <span class="va">Rt_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="fl">30</span><span class="op">)</span>

  <span class="va">imported_infections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>

  <span class="va">simulated_infections_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_infections.html">simulate_infections</a></span><span class="op">(</span>
    Rt <span class="op">=</span> <span class="va">Rt_1</span>, 
    imported_infections <span class="op">=</span> <span class="va">imported_infections</span><span class="op">)</span>
  
  <span class="va">simulated_infections_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_infections.html">simulate_infections</a></span><span class="op">(</span>
    Rt <span class="op">=</span> <span class="va">Rt_2</span>, 
    imported_infections <span class="op">=</span> <span class="va">imported_infections</span><span class="op">)</span></code></pre></div>
<p>If we plot the two trajectories, we can observe the number of infections in the case with a Re of 1.8 increases faster, as expected. We assume the first date is the 1st of December.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"01/12/2020"</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">simulated_infections_1</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,
  small_re <span class="op">=</span> <span class="va">simulated_infections_1</span>,
  big_re <span class="op">=</span> <span class="va">simulated_infections_2</span>
<span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">small_re</span>, color <span class="op">=</span> <span class="st">"Re = 1.4"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">big_re</span>, color <span class="op">=</span> <span class="st">"Re = 1.8"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of infections"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated infections'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="simulating_data_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
</div>
<div id="comparing-the-effect-of-imported-cases" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-the-effect-of-imported-cases" class="anchor"></a>Comparing the effect of imported cases</h3>
<p>Let us assume the question of interest is comparing the impact that imported infections have on the total case number, assuming the same evolution of the reproductive number.</p>
<p>The first step would be to define the desired reproductive number evolution in time, under which we want to simulate the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">Rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">14</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The next step is to decide the two series of imported infections, whose influence we want to compare. In both cases, a constant import of 5 cases per day for the first week will be assumed, to make sure the epidemic does not die off. After one week, one dataset will have no more imports, while the other will keep the 5 cases/day import rate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">imported_infections_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">74</span><span class="op">)</span><span class="op">)</span>
  <span class="va">imported_infections_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We will assume the same default mean and standard deviation of the serial interval of the epidemic in both cases, and we will use the <code>simulate_infections</code> function to perform the final infection simulations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">simulated_infections_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_infections.html">simulate_infections</a></span><span class="op">(</span>
    Rt <span class="op">=</span> <span class="va">Rt</span>, 
    imported_infections <span class="op">=</span> <span class="va">imported_infections_1</span><span class="op">)</span>

  <span class="va">simulated_infections_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_infections.html">simulate_infections</a></span><span class="op">(</span>
    Rt <span class="op">=</span> <span class="va">Rt</span>, 
    imported_infections <span class="op">=</span> <span class="va">imported_infections_2</span><span class="op">)</span></code></pre></div>
<p>The final step is plotting and analyzing the results. We assume the epidemic started on the 1st of December.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"01/12/2020"</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">simulated_infections_1</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,
  imports <span class="op">=</span> <span class="va">simulated_infections_1</span>,
  no_imports <span class="op">=</span> <span class="va">simulated_infections_2</span>
<span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">imports</span>, color <span class="op">=</span> <span class="st">"Imported cases"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">no_imports</span>, color <span class="op">=</span> <span class="st">"No imported cases"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of infections"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated infections'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="simulating_data_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>As expected, the case where imports did not stop, ends up to have substantially more infections with the same reproductive number.</p>
</div>
</div>
<div id="simulating-delayed-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-delayed-observations" class="anchor"></a>Simulating delayed observations</h2>
<p>Let us assume we want to simulate delayed observations of one of the infection series obtained above.</p>
<div id="constant-delay" class="section level3">
<h3 class="hasAnchor">
<a href="#constant-delay" class="anchor"></a>Constant delay</h3>
<p>In this example, we will simulate symptom onset data, assuming that the delay between infection and symptom onset follows a constant gamma distribution. The gamma distribution described below has a mean of 4.16 and a standard deviation of 8.94, resulting in a wide distribution. This was chosen as such to make the results of simulating the delayed observations apparent.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">shape_incubation</span> <span class="op">&lt;-</span> <span class="fl">3.2</span>
  <span class="va">scale_incubation</span> <span class="op">&lt;-</span> <span class="fl">5</span>
  <span class="va">delay_incubation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"gamma"</span>, shape <span class="op">=</span> <span class="va">shape_incubation</span>, scale <span class="op">=</span> <span class="va">scale_incubation</span><span class="op">)</span></code></pre></div>
<p>To make the data more realistic, we will also add some gaussian noise with a standard deviation of 0.5.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'gaussian'</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> </code></pre></div>
<p>The last step is to generate the simulated delayed observations, using the <code>simulate_delayed_observations</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">simulated_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_delayed_observations.html">simulate_delayed_observations</a></span><span class="op">(</span>
    infections <span class="op">=</span> <span class="va">simulated_infections_1</span>, 
    delay <span class="op">=</span> <span class="va">delay_incubation</span>,
    noise <span class="op">=</span> <span class="va">noise</span>
  <span class="op">)</span></code></pre></div>
<p>Plotting the delayed simulated observations alongside the simulated infections from earlier, we can observe the effect of the symptom onset delay introduced. We can also see the effect of adding noise to the simulation. <strong>We note that the most recent infections, for which the assumed delay has not passed yet, did not have time to be observed, thus they do not appear in the simulated delayed observations.</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"01/12/2020"</span><span class="op">)</span>, 
    length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">simulated_infections_1</span><span class="op">)</span>, 
    by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,
  no_delay <span class="op">=</span> <span class="va">simulated_infections_1</span>,
  delay <span class="op">=</span> <span class="va">simulated_observations</span>
<span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">no_delay</span>, color <span class="op">=</span> <span class="st">"Original infections"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">delay</span>, color <span class="op">=</span> <span class="st">"Delayed observations"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Simulated data"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated time-series'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Original simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">no_delay</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Original infections"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Delayed observations"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Simulated data"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated time-series'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Smoothed simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="simulating_data_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
</div>
<div id="time-varying-delay" class="section level3">
<h3 class="hasAnchor">
<a href="#time-varying-delay" class="anchor"></a>Time varying delay</h3>
<p>Another interesting case would be simulating delayed observations affected by a time varying delay. Let us assume we now want to generate a time series of case reports, not symptom onset reports. For this we consider the observations are affected by two separate delays, one constant through time and one that varies: the delay between infection and symptom onset (constant, defined as above), and the delay between symptom onset and case report (varying through time). We assume that, in this case, for the first 30 days of our analysis the delay between symptom onset and case report follows a certain gamma distribution, and for the following days, authorities change the testing policy and this delay shortens.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">shape_onset_to_report_1</span> <span class="op">=</span> <span class="fl">3.1</span>
  <span class="va">scale_onset_to_report_1</span> <span class="op">=</span> <span class="fl">1.8</span>
  <span class="va">delay_onset_to_report_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"gamma"</span>,
                                shape <span class="op">=</span> <span class="va">shape_onset_to_report_1</span>,
                                scale <span class="op">=</span> <span class="va">scale_onset_to_report_1</span><span class="op">)</span>
  
  <span class="va">shape_onset_to_report_2</span> <span class="op">=</span> <span class="fl">2.7</span>
  <span class="va">scale_onset_to_report_2</span> <span class="op">=</span> <span class="fl">1.6</span>
  <span class="va">delay_onset_to_report_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"gamma"</span>,
                                shape <span class="op">=</span> <span class="va">shape_onset_to_report_2</span>,
                                scale <span class="op">=</span> <span class="va">scale_onset_to_report_2</span><span class="op">)</span></code></pre></div>
<p>The next step is to build the delay distribution matrix. The delay matrix describes the individual delay between an event and its observation, with each column corresponding to a specific day. For example, the entry on the 5th row and 2nd column will represent the probability that an event that happened on day 2, is observed on day 5. To build the delay matrix, the first step is to obtain the daily probabilities of observation corresponding to the gamma distributions described above, as a discrete vector.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">delay_distrib_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_delay_distribution.html">build_delay_distribution</a></span><span class="op">(</span><span class="va">delay_onset_to_report_1</span><span class="op">)</span>
  <span class="va">delay_distrib_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_delay_distribution.html">build_delay_distribution</a></span><span class="op">(</span><span class="va">delay_onset_to_report_2</span><span class="op">)</span></code></pre></div>
<p>Next, we will fill in the matrix, knowing that the first 30 days the delay between the event (in this case, symptom onset) and observation (case report) follows the first gamma distribution, and for the following days, the second one. The resulting delay distribution matrix will then be a lower triangular square matrix, of (at least) the same size as the incidence data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># Initialize empty matrix</span>
    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">simulated_infections_1</span><span class="op">)</span>
    <span class="va">delay_distribution_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">N</span>, ncol <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
    
    <span class="co"># Right pad the above vectors with 0, if they are shorter than the desired size of the matrix</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">delay_distrib_1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">N</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">delay_distrib_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">delay_distrib_1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="va">N</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">delay_distrib_1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">delay_distrib_2</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">N</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">delay_distrib_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">delay_distrib_2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="va">N</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">delay_distrib_2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>

    <span class="co"># Fill the delay distribution matrix</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;=</span> <span class="fl">30</span><span class="op">)</span><span class="op">{</span>
        <span class="va">delay_distribution_matrix</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">delay_distrib_1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="va">delay_distribution_matrix</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">delay_distrib_2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span></code></pre></div>
<p>The last step is to use the delay distributions defined above to generate the desired observations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">simulated_observations_varying_delay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_delayed_observations.html">simulate_delayed_observations</a></span><span class="op">(</span>
    infections <span class="op">=</span> <span class="va">simulated_infections_1</span>, 
    delay <span class="op">=</span> <span class="va">delay_distribution_matrix</span>,
    noise <span class="op">=</span> <span class="va">noise</span>
  <span class="op">)</span></code></pre></div>
<p>Below we plot the original and smoothed results of the simulations above, alongside the original infections.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"01/12/2020"</span><span class="op">)</span>, 
    length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">simulated_infections_1</span><span class="op">)</span>, 
    by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,
  no_delay <span class="op">=</span> <span class="va">simulated_infections_1</span>,
  delay <span class="op">=</span> <span class="va">simulated_observations_varying_delay</span>
<span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">no_delay</span>, color <span class="op">=</span> <span class="st">"Original infections"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">delay</span>, color <span class="op">=</span> <span class="st">"Delayed observations"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Simulated data"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated time-series'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Original simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">no_delay</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Original infections"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Delayed observations"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Simulated data"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated time-series'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Smoothed simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="simulating_data_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
</div>
</div>
<div id="simulating-combined-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-combined-observations" class="anchor"></a>Simulating combined observations</h2>
<p>In the following example we will describe how to simulate partially delayed and fully delayed observations, generated by the same infection time-series.</p>
<p>Let us assume that two delays happen between infection and case report (eg. the incubation period, between infection and onset of symptoms, and the final delay between symptom onset and case report). In a real-life scenario, in some cases we might have access to only partially delayed observations (of the date of symptom onset, not only case report date). Including this information in the analyses provides more robust results. In order to simulate such data from an underlying infection time-series, we can use the <code>simulate_combined_observations</code> function.</p>
<p>We will use the infection series simulated before, and assume the partially observed data is symptom onset data (affected by <code>delay_incubation</code>), and the fully delayed data represents case report data (affected by both <code>delay_incubation</code> and <code>delay_onset_to_report_1</code>). We assume that in 50% of the cases reported, we also know the date of symptom onset. We assume the same gaussian noise defined above. One can simulate such data as showed below.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">combined_observations_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_combined_observations.html">simulate_combined_observations</a></span><span class="op">(</span>
    infections <span class="op">=</span> <span class="va">simulated_infections_1</span>,
    delay_until_partial <span class="op">=</span>  <span class="va">delay_incubation</span>,
    delay_until_final_report <span class="op">=</span>  <span class="va">delay_onset_to_report_1</span>,
    prob_partial_observation <span class="op">=</span> <span class="fl">0.5</span>,
    noise <span class="op">=</span> <span class="va">noise</span>
  <span class="op">)</span></code></pre></div>
<p>If we plot the smoothed time-series resulted, we observe that the fully delayed observations have a peak later than partially delayed observations, as expected. <strong>Note how the number of partially delayed observations drops to zero towards the present. This happens because most partially-delayed observations that correspond to these dates have not been yet reported (the full delay has not passed yet), hence they can not be counted yet.</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">combined_observations_1</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"01/12/2020"</span><span class="op">)</span>, 
  length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">combined_observations_1</span><span class="op">$</span><span class="va">partially_delayed</span><span class="op">)</span>, 
  by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>


<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">combined_observations_1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">fully_delayed</span>, color <span class="op">=</span> <span class="st">"Fully delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">partially_delayed</span>, color <span class="op">=</span> <span class="st">"Partially delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of observations"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated observations'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Original simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">combined_observations_1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">fully_delayed</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Fully delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">partially_delayed</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Partially delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of observations"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated observations'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Smoothed simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="simulating_data_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>If we redo the same analysis as before, but instead we assume that in only 20% of the cases reported, the date of symptom onset is known, we can also observe a difference in the total number of cases attributed to each time-series.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">combined_observations_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_combined_observations.html">simulate_combined_observations</a></span><span class="op">(</span>
    infections <span class="op">=</span> <span class="va">simulated_infections_1</span>,
    delay_until_partial <span class="op">=</span>  <span class="va">delay_incubation</span>,
    delay_until_final_report <span class="op">=</span>  <span class="va">delay_onset_to_report_1</span>,
    prob_partial_observation <span class="op">=</span> <span class="fl">0.2</span>,
    noise <span class="op">=</span> <span class="va">noise</span>
  <span class="op">)</span>

<span class="va">combined_observations_2</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"01/12/2020"</span><span class="op">)</span>, 
  length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">combined_observations_2</span><span class="op">$</span><span class="va">partially_delayed</span><span class="op">)</span>, 
  by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>


<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">combined_observations_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">fully_delayed</span>, color <span class="op">=</span> <span class="st">"Fully delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">partially_delayed</span>, color <span class="op">=</span> <span class="st">"Partially delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of observations"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated observations'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Original simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">combined_observations_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">fully_delayed</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Fully delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/smooth_incidence.html">smooth_incidence</a></span><span class="op">(</span><span class="va">partially_delayed</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Partially delayed"</span><span class="op">)</span>, lwd <span class="op">=</span>  <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"10 days"</span>, 
               date_labels <span class="op">=</span> <span class="st">'%b\n%d'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of observations"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'Simulated observations'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"top"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Smoothed simulation results"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="simulating_data_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jérémie Scire, Ana Grosu, Daniel Angst, Jana Huisman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
