---
title: "Re estimation using empirical delay data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Re estimation using empirical delay data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

TODO there's a lot of work to do on this vignette.

```{r setup}
library(estimateR)
```

```{r}
#TODO instead of generating data in the vignette, load external data containing these simulated observations
#Or we could use data from germany or HK
start_date <- as.Date("2020-04-01")
n_days <- 50
delay_increase <- 1.5
shape_initial_delay <- 6
scale_initial_delay <- 1.5
distribution_initial_delay <- list(name = "gamma", shape = shape_initial_delay, scale = scale_initial_delay)
seed <- 734
generated_empirical_delays <- generate_delay_data(origin_date = start_date,
                    n_time_steps = n_days,
                    delay_ratio_start_to_end = 1.5,
                    distribution_initial_delay = distribution_initial_delay,
                    seed = seed)

head(generated_empirical_delays, n = 10)

shape_incubation <- 3.2
scale_incubation <- 1.3
distribution_incubation <- list(name = "gamma", shape = shape_incubation, scale = scale_incubation)


toy_incidence_data <- c(4,9,19,14,36,16,39,27,46,
                          77,78,113,102,134,165,183,
                          219,247,266,308,304,324,346,
                          348,331,311,267,288,254,239,
                          214,176,132,134,121,109,113,
                          103,107,94,78,76,79,81,88,
                          94,99,106,114,123)

mean_serial_interval <- 4.8
std_serial_interval <- 2.3

estimation_window <- 3

toy_estimates <- smooth_deconvolve_estimate(
  toy_incidence_data,
  smoothing_method = "LOESS",
  deconvolution_method = "Richardson-Lucy delay distribution",
  estimation_method = "EpiEstim sliding window",
  delay_incubation = distribution_incubation,
  delay_onset_to_report = generated_empirical_delays,
  estimation_window = estimation_window,
  mean_serial_interval = mean_serial_interval,
  std_serial_interval  = std_serial_interval,
  output_Re_only = FALSE,
  ref_date = start_date,
  time_step = "day"
)
```
